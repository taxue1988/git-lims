{% extends 'admin/station_management.html' %}

{% block title %}固液配料 - 工站管理{% endblock %}

{% block main_content %}
{{ block.super }}

<style>
    .card-header-collapsible { cursor: pointer; user-select: none; }
    .status-dot {
        display: inline-block;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        margin-right: 6px;
    }
    .status-online { background-color: #28a745; }
    .status-offline { background-color: #dc3545; }
    .status-unknown { background-color: #6c757d; }
    /* 确保悬浮不触发布局移动（无transform/box-shadow变化） */
    .card:hover { transform: none; box-shadow: none; }
    .station-card .card-body { padding: 1rem; }
    .positions-row { margin-bottom: 0.5rem; }
    .positions-row:last-child { margin-bottom: 0; }
</style>

<!-- 工站状态 -->
<div class="card mt-3">
    <div class="card-header bg-info text-white d-flex justify-content-between align-items-center card-header-collapsible"
         data-bs-toggle="collapse" data-bs-target="#stationStatusContent" aria-expanded="true" aria-controls="stationStatusContent">
        <h4 class="mb-0"><i class="fas fa-cogs me-2"></i> 工站状态</h4>
        <div class="d-flex align-items-center">
            <span class="badge bg-light text-dark me-2">连接与统计</span>
            <i class="fas fa-chevron-down collapse-icon"></i>
        </div>
    </div>
    <div class="collapse show" id="stationStatusContent">
    <div class="card-body">
        <div class="row g-3">
            <div class="col-lg-3 col-md-4 col-sm-6">
                <div class="p-3 border rounded h-100">
                    <div class="fw-semibold mb-1">机械臂</div>
                    <div class="text-muted small"><span class="status-dot status-unknown"></span>连接状态</div>
                </div>
            </div>
            <div class="col-lg-3 col-md-4 col-sm-6">
                <div class="p-3 border rounded h-100">
                    <div class="fw-semibold mb-1">天平</div>
                    <div class="text-muted small"><span class="status-dot status-unknown"></span>连接状态</div>
                </div>
            </div>
            <div class="col-lg-3 col-md-4 col-sm-6">
                <div class="p-3 border rounded h-100">
                    <div class="fw-semibold mb-1">铼羽加粉仪</div>
                    <div class="text-muted small"><span class="status-dot status-unknown"></span>连接状态</div>
                </div>
            </div>
            <div class="col-lg-3 col-md-4 col-sm-6">
                <div class="p-3 border rounded h-100">
                    <div class="fw-semibold mb-1">运行信息</div>
                    <div class="text-muted small">运行时间：<span id="uptime-text">--:--:--</span></div>
                    <div class="text-muted small">待配料任务数：<span id="pending-count">0</span></div>
                    <div class="text-muted small">已完成配料任务数：<span id="done-count">0</span></div>
                </div>
            </div>
        </div>
    </div>
    </div>
</div>

<div class="card mt-3">
    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center card-header-collapsible"
         data-bs-toggle="collapse" data-bs-target="#currentPositions" aria-expanded="true" aria-controls="currentPositions">
        <h4 class="mb-0"><i class="fas fa-boxes me-2"></i> 当前仓位（10）</h4>
        <i class="fas fa-chevron-down collapse-icon"></i>
    </div>
    <div class="collapse show" id="currentPositions">
    <div class="card-body">
        <div class="row positions-row">
            <div class="col-lg-2 col-md-2 col-sm-4 mb-3">
                <div class="card h-100 station-card border-light">
                    <div class="card-body text-center">
                        <h5 class="card-title text-primary">位置 1</h5>
                        <p class="card-text text-muted small">转移仓</p>
                        <div class="current-container-info mb-3">
                            <div class="alert alert-light py-2 mb-2">
                                <i class="fas fa-circle"></i>
                                <span class="text-muted">位置空闲</span>
                            </div>
                        </div>
                        <div class="btn-group-vertical w-100" role="group">
                            <button type="button" class="btn btn-outline-primary btn-sm" disabled>
                                <i class="fas fa-plus"></i> 放置转移仓
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-2 col-md-2 col-sm-4 mb-3">
                <div class="card h-100 station-card border-light">
                    <div class="card-body text-center">
                        <h5 class="card-title text-primary">位置 2</h5>
                        <p class="card-text text-muted small">转移仓</p>
                        <div class="current-container-info mb-3">
                            <div class="alert alert-light py-2 mb-2">
                                <i class="fas fa-circle"></i>
                                <span class="text-muted">位置空闲</span>
                            </div>
                        </div>
                        <div class="btn-group-vertical w-100" role="group">
                            <button type="button" class="btn btn-outline-primary btn-sm" disabled>
                                <i class="fas fa-plus"></i> 放置转移仓
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-2 col-md-2 col-sm-4 mb-3">
                <div class="card h-100 station-card border-light">
                    <div class="card-body text-center">
                        <h5 class="card-title text-primary">位置 3</h5>
                        <p class="card-text text-muted small">转移仓</p>
                        <div class="current-container-info mb-3">
                            <div class="alert alert-light py-2 mb-2">
                                <i class="fas fa-circle"></i>
                                <span class="text-muted">位置空闲</span>
                            </div>
                        </div>
                        <div class="btn-group-vertical w-100" role="group">
                            <button type="button" class="btn btn-outline-primary btn-sm" disabled>
                                <i class="fas fa-plus"></i> 放置转移仓
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-2 col-md-2 col-sm-4 mb-3">
                <div class="card h-100 station-card border-light">
                    <div class="card-body text-center">
                        <h5 class="card-title text-primary">位置 4</h5>
                        <p class="card-text text-muted small">转移仓</p>
                        <div class="current-container-info mb-3">
                            <div class="alert alert-light py-2 mb-2">
                                <i class="fas fa-circle"></i>
                                <span class="text-muted">位置空闲</span>
                            </div>
                        </div>
                        <div class="btn-group-vertical w-100" role="group">
                            <button type="button" class="btn btn-outline-primary btn-sm" disabled>
                                <i class="fas fa-plus"></i> 放置转移仓
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-2 col-md-2 col-sm-4 mb-3">
                <div class="card h-100 station-card border-light">
                    <div class="card-body text-center">
                        <h5 class="card-title text-primary">位置 5</h5>
                        <p class="card-text text-muted small">转移仓</p>
                        <div class="current-container-info mb-3">
                            <div class="alert alert-light py-2 mb-2">
                                <i class="fas fa-circle"></i>
                                <span class="text-muted">位置空闲</span>
                            </div>
                        </div>
                        <div class="btn-group-vertical w-100" role="group">
                            <button type="button" class="btn btn-outline-primary btn-sm" disabled>
                                <i class="fas fa-plus"></i> 放置转移仓
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row positions-row">
            <div class="col-lg-2 col-md-2 col-sm-4 mb-3">
                <div class="card h-100 station-card border-light">
                    <div class="card-body text-center">
                        <h5 class="card-title text-primary">位置 6</h5>
                        <p class="card-text text-muted small">转移仓</p>
                        <div class="current-container-info mb-3">
                            <div class="alert alert-light py-2 mb-2">
                                <i class="fas fa-circle"></i>
                                <span class="text-muted">位置空闲</span>
                            </div>
                        </div>
                        <div class="btn-group-vertical w-100" role="group">
                            <button type="button" class="btn btn-outline-primary btn-sm" disabled>
                                <i class="fas fa-plus"></i> 放置转移仓
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-2 col-md-2 col-sm-4 mb-3">
                <div class="card h-100 station-card border-light">
                    <div class="card-body text-center">
                        <h5 class="card-title text-primary">位置 7</h5>
                        <p class="card-text text-muted small">转移仓</p>
                        <div class="current-container-info mb-3">
                            <div class="alert alert-light py-2 mb-2">
                                <i class="fas fa-circle"></i>
                                <span class="text-muted">位置空闲</span>
                            </div>
                        </div>
                        <div class="btn-group-vertical w-100" role="group">
                            <button type="button" class="btn btn-outline-primary btn-sm" disabled>
                                <i class="fas fa-plus"></i> 放置转移仓
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-2 col-md-2 col-sm-4 mb-3">
                <div class="card h-100 station-card border-light">
                    <div class="card-body text-center">
                        <h5 class="card-title text-primary">位置 8</h5>
                        <p class="card-text text-muted small">转移仓</p>
                        <div class="current-container-info mb-3">
                            <div class="alert alert-light py-2 mb-2">
                                <i class="fas fa-circle"></i>
                                <span class="text-muted">位置空闲</span>
                            </div>
                        </div>
                        <div class="btn-group-vertical w-100" role="group">
                            <button type="button" class="btn btn-outline-primary btn-sm" disabled>
                                <i class="fas fa-plus"></i> 放置转移仓
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-2 col-md-2 col-sm-4 mb-3">
                <div class="card h-100 station-card border-light">
                    <div class="card-body text-center">
                        <h5 class="card-title text-primary">位置 9</h5>
                        <p class="card-text text-muted small">转移仓</p>
                        <div class="current-container-info mb-3">
                            <div class="alert alert-light py-2 mb-2">
                                <i class="fas fa-circle"></i>
                                <span class="text-muted">位置空闲</span>
                            </div>
                        </div>
                        <div class="btn-group-vertical w-100" role="group">
                            <button type="button" class="btn btn-outline-primary btn-sm" disabled>
                                <i class="fas fa-plus"></i> 放置转移仓
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-2 col-md-2 col-sm-4 mb-3">
                <div class="card h-100 station-card border-light">
                    <div class="card-body text-center">
                        <h5 class="card-title text-primary">位置 10</h5>
                        <p class="card-text text-muted small">转移仓</p>
                        <div class="current-container-info mb-3">
                            <div class="alert alert-light py-2 mb-2">
                                <i class="fas fa-circle"></i>
                                <span class="text-muted">位置空闲</span>
                            </div>
                        </div>
                        <div class="btn-group-vertical w-100" role="group">
                            <button type="button" class="btn btn-outline-primary btn-sm" disabled>
                                <i class="fas fa-plus"></i> 放置转移仓
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
</div>

<div class="card mt-3">
    <div class="card-header bg-warning text-dark d-flex justify-content-between align-items-center card-header-collapsible"
         data-bs-toggle="collapse" data-bs-target="#dispenseTasks" aria-expanded="true" aria-controls="dispenseTasks">
        <h4 class="mb-0"><i class="fas fa-tasks me-2"></i> 配料任务列表</h4>
        <i class="fas fa-chevron-down collapse-icon"></i>
    </div>
    <div class="collapse show" id="dispenseTasks">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-bordered table-hover" width="100%" cellspacing="0">
                <thead class="table-light">
                    <tr>
                        <th style="width: 140px;">实验任务ID</th>
                        <th>名称</th>
                        <th style="width: 140px;">试管ID</th>
                        <th>物料详情</th>
                        <th style="width: 180px;">创建时间</th>
                    </tr>
                </thead>
                <tbody id="experiment-list-body">
                    <!-- 任务数据将通过JavaScript动态加载 -->
                </tbody>
            </table>
        </div>
    </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function () {
    var breadcrumb = document.querySelector('nav[aria-label="breadcrumb"] .breadcrumb');
    if (!breadcrumb) return;
    var links = breadcrumb.querySelectorAll('.breadcrumb-item a');
    var indicator = breadcrumb.querySelector('.breadcrumb-indicator');
    var target = null;
    for (var i = 0; i < links.length; i++) {
        if (links[i].textContent.trim() === '固液配料') { target = links[i]; break; }
    }
    if (target) {
        links.forEach(function(a){ a.classList.remove('active'); });
        target.classList.add('active');
        // 同步指示器位置
        if (indicator) {
            indicator.style.width = target.offsetWidth + 'px';
            indicator.style.transform = 'translateX(' + target.offsetLeft + 'px)';
        }
    }

    // 卡片折叠动画与箭头旋转（参考AGV页面）
    var collapseElements = document.querySelectorAll('[data-bs-toggle="collapse"]');
    collapseElements.forEach(function(element) {
        element.addEventListener('click', function() {
            var icon = this.querySelector('.collapse-icon');
            var target = document.querySelector(this.getAttribute('data-bs-target'));
            setTimeout(function() {
                if (target && target.classList.contains('show')) {
                    if (icon) icon.style.transform = 'rotate(0deg)';
                } else {
                    if (icon) icon.style.transform = 'rotate(180deg)';
                }
            }, 50);
        });
    });
});
</script>
{% endblock %}


